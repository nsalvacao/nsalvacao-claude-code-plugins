<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Productivity Cockpit</title>
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'%3E%3Crect x='4' y='2' width='24' height='28' rx='4' fill='%23faf9f5' stroke='%23D97757' stroke-width='2'/%3E%3Crect x='8' y='0' width='16' height='5' rx='2.5' fill='%23D97757'/%3E%3Cpath d='M9 13l3 3 5-5' fill='none' stroke='%23D97757' stroke-width='2.5' stroke-linecap='round' stroke-linejoin='round'/%3E%3Crect x='20' y='12' width='5' height='2' rx='1' fill='%23c4c4c2'/%3E%3Crect x='9' y='20' width='10' height='2' rx='1' fill='%23c4c4c2'/%3E%3Crect x='9' y='25' width='7' height='2' rx='1' fill='%23c4c4c2'/%3E%3C/svg%3E">
  
  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  
  <!-- CDNs -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
  
  <!-- Local Styles -->
  <link rel="stylesheet" href="assets/css/styles.css">
</head>
<body>

  <aside>
    <div class="sidebar-header">
      <svg width="24" height="24" viewBox="0 0 32 32">
        <rect x="4" y="2" width="24" height="28" rx="4" fill="#faf9f5" stroke="#D97757" stroke-width="2"/>
        <rect x="8" y="0" width="16" height="5" rx="2.5" fill="#D97757"/>
        <path d="M9 13l3 3 5-5" fill="none" stroke="#D97757" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      <h1>Cockpit</h1>
    </div>
    <nav>
      <div class="nav-item active" data-view="overview"><span>üè†</span> Overview</div>
      <div class="nav-item" data-view="inventory" id="nav-inventory"><span>üì¶</span> Inventory</div>
      <div class="nav-item" data-view="tasks" id="nav-tasks"><span>üìã</span> Tasks</div>
      <div class="nav-item" data-view="memory" id="nav-memory"><span>üß†</span> Memory</div>
    </nav>

    <!-- Timer Section -->
    <div class="sidebar-section" id="timerWidget">
      <div class="sidebar-section-title">Focus Session</div>
      <div style="display: flex; align-items: center; justify-content: space-between; background: var(--bg-card); padding: 8px 12px; border-radius: 8px; border: 1px solid var(--border-light);">
        <div id="timerDisplay" style="font-family: 'JetBrains Mono'; font-weight: 600; font-size: 16px;">25:00</div>
        <button id="timerToggleBtn" style="padding: 4px 8px; font-size: 10px;">Start</button>
      </div>
    </div>

    <div class="sidebar-section" id="pulseWidget">
      <div class="sidebar-section-title">Project Pulse</div>
      <div id="pulseList" class="pulse-list">
        <div class="pulse-item"><span class="pulse-dot dot-gray"></span> Loading...</div>
      </div>
    </div>

    <div class="sidebar-footer">
      <button class="project-selector" id="rootPickerBtn">Select Project Root</button>
      <div id="rootName" style="font-size: 11px; color: var(--text-muted); margin-top: 8px; text-align: center;"></div>
    </div>
  </aside>

  <main>
    <header>
      <div class="view-title">
        <div class="breadcrumb" id="breadcrumb">project / cockpit</div>
        <h2 id="currentViewTitle">Overview</h2>
      </div>
      
      <div style="flex: 1; max-width: 400px; margin: 0 40px;">
        <div style="position: relative;">
          <input type="text" id="globalSearch" placeholder="Search everything... (Ctrl+K)" 
                 style="width: 100%; background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 8px; padding: 10px 16px 10px 40px; font-size: 13px; outline: none;">
          <span style="position: absolute; left: 14px; top: 10px; opacity: 0.5;">üîç</span>
        </div>
      </div>

      <div class="actions">
        <button id="refreshBtn">Refresh Data</button>
      </div>
    </header>

    <!-- OVERVIEW PANEL -->
    <div class="view-panel active" id="overviewPanel">
      <div class="kpi-grid">
        <div class="kpi-card"><div class="kpi-value" id="kpi-progress">0%</div><div class="kpi-label">Overall Progress</div></div>
        <div class="kpi-card"><div class="kpi-value" id="kpi-clis">0 / 0</div><div class="kpi-label">CLI Coverage</div></div>
        <div class="kpi-card"><div class="kpi-value" id="kpi-confidence">0.00</div><div class="kpi-label">Avg Confidence</div></div>
        <div class="kpi-card"><div class="kpi-value" id="kpi-blockers">0</div><div class="kpi-label">Critical Blockers</div></div>
      </div>
      <div class="dashboard-row">
        <div class="chart-container">
          <h3 style="margin-bottom: 16px; font-size: 12px; font-weight: 600; text-transform: uppercase; color: var(--text-muted);">Phase Progress</h3>
          <div style="height: 250px;"><canvas id="phaseChart"></canvas></div>
        </div>
        <div class="chart-container">
          <h3 style="margin-bottom: 16px; font-size: 12px; font-weight: 600; text-transform: uppercase; color: var(--text-muted);">Recent Activity</h3>
          <div id="recentActivity" style="font-size: 13px; color: var(--text-secondary); display: flex; flex-direction: column; gap: 8px;"></div>
        </div>
      </div>
    </div>

    <!-- OTHER PANELS -->
    <div class="view-panel" id="inventoryPanel"><div class="inventory-grid" id="inventoryGrid"></div></div>
    <div class="view-panel" id="tasksPanel"><div id="board" class="board"></div></div>
    <div class="view-panel" id="memoryPanel"><div class="memory-tabs" id="memoryTabs"></div><div id="memoryContent" class="memory-grid"></div></div>
  </main>

  <!-- MODAL -->
  <div class="modal-overlay" id="modalOverlay">
    <div class="modal">
      <div class="modal-header">
        <div id="modalTitleContainer"><h3 id="modalTitle" style="font-size: 1.1rem; font-weight: 600;">Detail</h3></div>
        <div style="display: flex; align-items: center; gap: 20px;">
          <div class="modal-tabs">
            <button class="modal-tab active" data-mod="preview">Preview</button>
            <button class="modal-tab" data-mod="edit">Edit Source</button>
          </div>
          <button id="modalCloseBtn" style="border:none; background:none; font-size: 32px; cursor:pointer; color:var(--text-muted); line-height: 1;">&times;</button>
        </div>
      </div>
      <div class="modal-body">
        <div id="modalPreview" class="markdown-content"></div>
        <div id="modalEditor"><textarea id="modalTextarea" placeholder="Enter markdown content..."></textarea></div>
      </div>
      <div class="modal-footer">
        <span id="saveStatus" style="font-size: 12px; color: var(--success); margin-right: auto; display: none;">Changes saved successfully</span>
        <button id="modalCancelBtn">Cancel</button>
        <button id="modalSaveBtn" class="primary">Save Changes</button>
      </div>
    </div>
  </div>

  <!-- SPOTLIGHT OVERLAY -->
  <div class="spotlight-overlay" id="spotlightOverlay">
    <div class="spotlight-modal">
      <div style="padding: 20px; border-bottom: 1px solid var(--border); display: flex; align-items: center; gap: 12px;">
        <span style="font-size: 20px; opacity: 0.5;">üîç</span>
        <input type="text" id="spotlightSearch" placeholder="Type to search tasks, memory or CLIs..." 
               style="flex: 1; background: transparent; border: none; font-size: 18px; outline: none; font-family: inherit;">
        <span style="font-size: 11px; padding: 4px 8px; background: var(--bg-secondary); border-radius: 4px; color: var(--text-muted);">ESC to close</span>
      </div>
      <div id="spotlightResults" class="spotlight-results"></div>
    </div>
  </div>

  <!-- CHATBOT INTERFACE -->
  <div id="chatToggleBtn" style="position: fixed; bottom: 24px; right: 24px; width: 56px; height: 56px; background: var(--accent); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 24px; cursor: pointer; box-shadow: 0 8px 24px rgba(217, 119, 87, 0.3); z-index: 900; transition: transform 0.2s ease;">
    üí¨
  </div>

  <div id="chatPanel" style="display: none; position: fixed; bottom: 90px; right: 24px; width: 400px; height: 600px; background: white; border-radius: 16px; box-shadow: 0 12px 48px rgba(0,0,0,0.15); border: 1px solid var(--border); flex-direction: column; overflow: hidden; z-index: 900;">
    <div style="padding: 16px 20px; border-bottom: 1px solid var(--border); background: var(--bg-primary); display: flex; justify-content: space-between; align-items: center;">
      <div style="font-weight: 600; font-size: 14px; display: flex; align-items: center; gap: 8px;">
        <span style="width: 8px; height: 8px; background: var(--success); border-radius: 50%;"></span>
        <span id="chatAssistantName">AI Assistant</span>
      </div>
      <button id="closeChatBtn" style="border:none; background:none; font-size: 20px; cursor:pointer; color:var(--text-muted)">&times;</button>
    </div>
    <div id="chatHistory" style="flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 16px; background: #fbfbfa;">
      <div style="background: white; padding: 12px 16px; border-radius: 12px; border: 1px solid var(--border-light); font-size: 13px; color: var(--text-secondary); align-self: flex-start; max-width: 85%;">
        Hi! I'm your local AI assistant. I have full context about your tasks and project. How can I help?
      </div>
    </div>
    <div style="padding: 16px; border-top: 1px solid var(--border); display: flex; gap: 8px; background: white;">
      <input type="text" id="chatInput" placeholder="Ask about the project..." style="flex: 1; border: 1px solid var(--border); padding: 10px 14px; border-radius: 8px; font-size: 13px; outline: none;">
      <button id="sendChatBtn" class="primary" style="padding: 8px 16px;">Send</button>
    </div>
  </div>

  <!-- App Script -->
  <script src="assets/js/app.js"></script>
</body>
</html>